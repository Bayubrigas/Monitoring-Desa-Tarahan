// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Master data vitamin
model Vitamin {
  id        String @id @default(cuid())
  nama      String @unique
  keterangan String?
  pemberian PemberianVitamin[]
}

// Riwayat pemberian vitamin dalam pemeriksaan
model PemberianVitamin {
  id             String @id @default(cuid())
  pemeriksaanId  String
  vitaminId      String

  pemeriksaan Pemeriksaan @relation(fields: [pemeriksaanId], references: [id])
  vitamin     Vitamin     @relation(fields: [vitaminId], references: [id])

  createdAt DateTime @default(now())
  @@unique([pemeriksaanId, vitaminId])
}

enum MetodePengukuran {
  Ditimbang
  PerkiraanOrtu
  TidakDiukur
}

model Anak {
  id            String         @id @default(cuid())
  nama          String
  tanggalLahir  DateTime
  jenisKelamin  String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  pemeriksaan   Pemeriksaan[]
}

model Pemeriksaan {
  id                String               @id @default(cuid())
  anakId            String
  beratBadan        Float?
  tinggiBadan       Float?
  lingkarKepala     Float?
  usiaBulan         Int
  tanggal           DateTime             @default(now())

  metodeBerat       MetodePengukuran?    @default(Ditimbang)
  metodeTinggi      MetodePengukuran?    @default(Ditimbang)
  metodeLingkarKepala MetodePengukuran? @default(Ditimbang)

  keterangan        String?

  anak              Anak                 @relation(fields: [anakId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  pemberianVitamin  PemberianVitamin[]

  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
}