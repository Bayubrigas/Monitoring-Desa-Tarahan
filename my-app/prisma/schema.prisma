// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ----------------------------------------------------
// ENUM
// ----------------------------------------------------

enum MetodePengukuran {
  Ditimbang
  PerkiraanOrtu
  TidakDiukur
  DiukurPanjangBadan      // ← tambahkan
  DiukurLingkarKepala     // ← tambahkan
}

enum JenisKelamin {
  L
  P
}

// ----------------------------------------------------
// MASTER VITAMIN
// ----------------------------------------------------

model Vitamin {
  id         String              @id @default(cuid())
  nama       String              @unique
  keterangan String?
  pemberian  PemberianVitamin[]
}

// Pivot untuk vitamin yang diberikan dalam pemeriksaan
model PemberianVitamin {
  id            String        @id @default(cuid())
  pemeriksaanId String
  vitaminId     String

  pemeriksaan   Pemeriksaan   @relation(fields: [pemeriksaanId], references: [id])
  vitamin       Vitamin        @relation(fields: [vitaminId], references: [id])

  createdAt     DateTime      @default(now())

  @@unique([pemeriksaanId, vitaminId])
}

// ----------------------------------------------------
// DATA ANAK
// ----------------------------------------------------

model Anak {
  id           String         @id @default(cuid())
  nama         String
  tanggalLahir DateTime
  jenisKelamin JenisKelamin
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  pemeriksaan  Pemeriksaan[]

  // Index untuk performa pencarian
  @@index([nama])
  @@index([tanggalLahir])
}

// ----------------------------------------------------
// PEMERIKSAAN POSYANDU
// ----------------------------------------------------

model Pemeriksaan {
  id                 String             @id @default(cuid())
  anakId             String
  beratBadan         Float?
  tinggiBadan        Float?
  lingkarKepala      Float?
  usiaBulan          Int
  tanggal            DateTime           @default(now())

  metodeBerat        MetodePengukuran?  @default(Ditimbang)
  metodeTinggi       MetodePengukuran?  @default(Ditimbang)
  metodeLingkarKepala MetodePengukuran? @default(Ditimbang)

  keterangan         String?

  anak               Anak               @relation(fields: [anakId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  pemberianVitamin   PemberianVitamin[]

  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
}

model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
}
